{% extends "layout_creditos.html" %}
{% load humanize %}

{% block title %} Listado de Cr√©ditos | Sistema de Cr√©ditos {% endblock %}

{% block content %}

<style>
    .titulo-financiera { font-weight: 700; color: #2c3e50; }

    .filtro-card { border-radius: 12px; padding: 20px; background: #fff; 
                   box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

    .table-financiera th { background: #2c3e50 !important; color: #fff; }

    .badge-estado { padding: 6px 10px; border-radius: 6px; }
    .estado-activo { background: #2ecc71; color: white; }
    .estado-mora { background: #e67e22; color: white; }
    .estado-juridico { background: #8e44ad; color: white; }
    .estado-finalizado { background: #7f8c8d; color: white; }
</style>

<div class="container mt-4">

    <h2 class="titulo-financiera mb-4">üìã Listado de Cr√©ditos</h2>

    <!-- Filtros -->
    <div class="filtro-card mb-4">
        <form method="get" class="row g-3">

            <!-- C√©dula -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">C√©dula</label>
                <input type="text" name="cedula" value="{{ request.GET.cedula }}" class="form-control" placeholder="Ej: 1012345678">
            </div>

            <!-- Nombre -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Nombre</label>
                <input type="text" name="nombre" value="{{ request.GET.nombre }}" class="form-control" placeholder="Ej: Juan P√©rez">
            </div>

            <!-- Placa -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Placa veh√≠culo</label>
                <input type="text" name="placa" value="{{ request.GET.placa }}" class="form-control" placeholder="ABC123">
            </div>

            <!-- ID Cr√©dito -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">ID Cr√©dito</label>
                <input type="number" name="id" value="{{ request.GET.id }}" class="form-control">
            </div>

            <!-- Rango fechas -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Desde</label>
                <input type="date" name="fecha_desde" value="{{ request.GET.fecha_desde }}" class="form-control">
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">Hasta</label>
                <input type="date" name="fecha_hasta" value="{{ request.GET.fecha_hasta }}" class="form-control">
            </div>

            <!-- Rango valor -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Valor m√≠nimo</label>
                <input type="number" name="valor_min" value="{{ request.GET.valor_min }}" class="form-control">
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">Valor m√°ximo</label>
                <input type="number" name="valor_max" value="{{ request.GET.valor_max }}" class="form-control">
            </div>

            <!-- Estado -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Estado</label>
                <select name="estado" class="form-select">
                    <option value="">Todos</option>
                    <option value="Activo" {% if request.GET.estado == "Activo" %}selected{% endif %}>Activo</option>
                    <option value="En mora" {% if request.GET.estado == "En mora" %}selected{% endif %}>En mora</option>
                    <option value="Cobro jur√≠dico" {% if request.GET.estado == "Cobro jur√≠dico" %}selected{% endif %}>Cobro jur√≠dico</option>
                    <option value="Finalizado" {% if request.GET.estado == "Finalizado" %}selected{% endif %}>Finalizado</option>
                </select>
            </div>

            <!-- Botones -->
            <div class="col-md-3 d-flex align-items-end mt-4">
                <button class="btn btn-primary w-100">Aplicar filtros</button>
            </div>

            <div class="col-md-3 d-flex align-items-end mt-4">
                <a href="{% url 'lista_creditos' %}" class="btn btn-secondary w-100">Limpiar</a>
            </div>

        </form>
    </div>

    <!-- Tabla -->
    <div class="card shadow-sm">
        <div class="card-body p-0">

            <table class="table table-striped table-hover m-0 table-financiera">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Cliente</th>
                        <th>Veh√≠culo</th>
                        <th>Estado</th>
                        <th>Valor</th>
                        <th>Cuotas</th>
                        <th>Detalle</th>
                    </tr>
                </thead>

                <tbody>
                    {% for c in page_obj %}
                    <tr>
                        <td class="fw-bold text-center">{{ c.id }}</td>

                        <td>{{ c.usuario.nombre }} {{ c.usuario.p_apellido }}</td>

                        <td>{{ c.vehiculo.placa }}</td>

                        <td class="text-center">
                            {% if c.estado == "Activo" %}
                                <span class="badge-estado estado-activo">Activo</span>
                            {% elif c.estado == "En mora" %}
                                <span class="badge-estado estado-mora">En mora</span>
                            {% elif c.estado == "Cobro jur√≠dico" %}
                                <span class="badge-estado estado-juridico">Cobro jur√≠dico</span>
                            {% elif c.estado == "Finalizado" %}
                                <span class="badge-estado estado-finalizado">Finalizado</span>
                            {% endif %}
                        </td>

                        <td>${{ c.valor_inicial|floatformat:0|intcomma }}</td>

                        <td class="text-center">{{ c.cuotas }}</td>

                        <td class="text-center">
                            <a href="{% url 'detalle_credito' c.id %}" class="btn btn-sm btn-info">Ver</a>
                        </td>

                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center py-3 text-muted">No se encontraron resultados.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
    </div>

    <!-- Paginaci√≥n -->
    <nav class="mt-4 d-flex justify-content-center">
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&{{ querystring }}">Anterior</a></li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Anterior</span></li>
            {% endif %}

            {% for i in page_obj.paginator.page_range %}
                <li class="page-item {% if page_obj.number == i %}active{% endif %}">
                    <a class="page-link" href="?page={{ i }}&{{ querystring }}">{{ i }}</a>
                </li>
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&{{ querystring }}">Siguiente</a></li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
            {% endif %}
        </ul>
    </nav>

</div>

{% endblock %}
